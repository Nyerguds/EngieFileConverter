CnC64FileConverter
-------------- Created by by Nyerguds (04/04/2017)

This tool allows viewing and saving from and to several file formats found in the Nintendo 64 ROM
of the Command & Conquer game.

The files can be extracted from / inserted into the ROM with the Universal Game Decompressor
(GEDecompressor), made by SubDrag.
http://www.goldeneyevault.com/viewfile.php?id=213

Special thanks to Kamuix and Chad1233 for their help in testing this, and to Moon Flower for the
help in designing the palette manager.


Features:
--------
-Supports opening and saving all classic image types (png/gif/bmp/jpg), and a load of game formats.
-Gives a visual representation of the loaded file, with zoom and adjustable background colour.
-Can display and edit the file's colour palette, if it has one.
-Can save opened files as any supported format, though some conversions are obviously impossible;
 high-colour images can't be saved as palette, and only maps can be saved as maps.
-Preserves the color palette when saving 4-bit and 8-bit paletted images.
-Supports drag & drop for opening files.
-Can be used as command line converter with the following syntax:
    CnC64FileConverter.exe infile.img outfile.png
 This only works for file formats that can be identified purely by extension, though.
-Has utilities to help generate height maps for missions.
-Offers save options for the types that need them.


Acknowledgements:
----------------
The PC C&C formats were deciphered using documentation written by Vladan Bato.

The compression code used for handling the CPS and LCW formats was gracefully provided by the
people of the RA++ project:
https://redalertpp.org/

The Dynamix decompression code was converted from the C++ code of VOGONS.org user tikalat's Midi
Tools. It contains no license but I assume the fact he included the code implies that he doesn't
mind it being useful to more people.
https://www.vogons.org/viewtopic.php?p=273448#p273448

The K.O.R.T. image format was decoded thanks to documentation included in the K.O.R.T. savegame
editor written by David Eriksson, aka Edison of 2GooD.
http://www.2good.nu/projekt/korted

The code of ScummVM helped a lot to figure out the compression on the Elvira VGA format.
https://www.scummvm.org/


Version history:
---------------
This tool started as the CnC64ImageViewer, but later got expanded to a full conversion suite.
At that point, it became the CnC64FileConverter v1.0. Since I'm adding more file formats,
it may become a more general game formats conversion tool.

CnC64FileConverter versions:

v1.2.8: (25/01/2018 18:50)
-Added vertical image scrolling with shift + scrollwheel.
-Image types that can natevely be opened by the .Net framework bu are not specifically supported
 (like .tif) will now open as general type "Image".
-The disabled palette dropdown will now correctly display the reason why it is disabled.
-When loading a file, the zoom factor will automatically adjust to the loaded image.

v1.2.7: (15/11/2017 07:36)
-Fixed background handling in MA8 chunk data by switching index 00 and FF on the image.

v1.2.6: (15/11/2017 14:32)
-Added support for MA8 format used in the Macintosh versions of the Dynamix images.

v1.2.5: (09/11/2017 13:47)
-Fixed the X and Y trimming functions to make WSA save work correctly.

v1.2.4: (20/10/2017 13:37)
-Fixed some checks in the file load to make them fail properly instead of giving internal errors.
-Added Westwood WSA format, though the detection might not be 100% correct yet.

v1.2.3: (26/09/2017 19:05)
-Fixed oversight in the KotB format. The written files now work correctly in the game.

v1.2.2: (24/09/2017 16:50)
-Fixed main chunks in Dynamix files not saving as container chunks.

v1.2.1: (23/09/2017 21:23)
-Fixed crash when saving images with uneven width in Dynamix VGA/BIN format.
-Added tighter checks on Dynamix image input; they can only handle widths divisible by 8.
-Exporting to frames now always takes png as default format.

v1.2: (22/09/2017 15:30)
-Added new Save Options dialog for types that need extra options for saving.
-Added very efficient automatic filter system to determine what types a file can be saved as.
-Removed "export" function; it was no longer useful.
-Fixed errors in loading and saving code for Kings of the Beach .PAK format.
-Restricted Kings of the Beach .PAK format to 320x200 for better autodetect accuracy.
-Changed form size to be able to display a 640x480 image without needing a resize.
-Optimised, simplified and unified all the different RLE compression methods.
-Added support for loading and saving Westwood CPS using the standard LZW algorithm.
-Removed automatic grayscale conversion on paletteless C&C64 images.
-Detects most specific type when opening a general format like "Image" through the Open menu.
-Type detection is restricted to the types contained in the chosen type in the Open File menu.

v1.1.4: (13/09/2017 09:27)
-Improved file detection checks and error message handling in several file types.

v1.1.3: (12/09/2017 21:20)
-Optimised RLE compression for Elvira VGA format to compress better than the original.
-Added checks on empty data before saving.
-Changed frames handling so types can have frames without being seen as a frames container.
-Added support for viewing the 4-bit version of Dynamix SCR files using new frames system.
-Disabled support for Dynamix BMP files; the image data can't actually be viewed anyway.
-When opening an empty file, the program will not not attempt type detection.
-Importing a range of frames from numbered files now also works when opening an empty file.
-Saving frames data without a full image filters out non-frames types in the Save dialog.
-Fixed bug where the stride wasn't collapsed to the width on grayscale C&C64 images.
-Added support for King of the Beach .PAK image format.

v1.1.2: (07/09/2017 15:03)
-Added better support for frames; when opening an image with a numeric suffix that is part of
 a range of images, the tool will ask to load it as frames.
-Added Elvira VGA writing support.

v1.1.1: (10/08/2017 15:53)
-Added support for different compression types in CPS files.

v1.1.0: (05/08/2017 19:43)
-Added support for the KORT_DAT.### images of "King Arthur's Knights of the Round Table"
-For formats with optional compression, (like SCR), hold shift while clicking "save"
 to save as uncompressed.

v1.0.9: (31/07/2017 00:24)
-Fixed confusing naming in internal toolsets, and simplified byte reading/writing methods.
-Fixed bug where the height map conversion tools caused files to lose their file name,
 which caused crashes when trying to save the result.
-Fixed errors in CPS reading.
-Added Dynamix SCR reading and writing, though only the VGA/BIN type is supported.

v1.0.8: (05/05/2017 17:53)
-Fixed bugs in opening logic that made the program give errors on opening .IMG files.
-Fixed oversight in .IMG saving logics that didn't pass on the palette length.
-Fixed bug in the N64 8-bit palette data that gave it the .pa4 extension.
-Added support for reading and writing LCW-compressed images.

v1.0.7: (01/05/2017 20:08)
-Added an option to copy the image to the clipboard.
-Added palette support for paletteless file formats.
-Added the ability to open C&C template (tileset) files.

v1.0.6: (07/04/2017 22:34)
-Fixed bug in the file open logic that prevented opening certain types through the menus.

v1.0.5: (07/04/2017 21:21)
-Fixed a bug that prevented full clearing of the left map edge
-Fixed a minor bug in the terrain type definitions.
-When an ini file dropped into the program it will check if a map can be found for it.
-UI options now get disabled when not applicable.

v1.0.4: (07/04/2017 17:32)
-The converted 65x65 height maps will immediately be loaded in the program as paletteless IMG
 format, so they can more easily be saved into that format.

v1.0.3: (07/04/2017 15:30)
-Fixed small palette import bug in tilesets
-Added tools to generate height maps from missions.

v1.0.2: (04/04/2017 23:53)
-Fixed png export of map files.

v1.0.1: (04/04/2017 23:33)
-Fixed behaviour of map import to allow PC maps saved by CCMAP.

v1.0: (04/04/2017 22:33)
-Removed img type debug info (internal data size) from the user interface.
-Can now open normal images (png/gif/bmp/jpg).
-Can now open both PC and N64 format C&C maps, visualizing them as 64x64 image with terrain types,
 and allowing saving as the other type (or as image).
-Added code to correctly open paletted png images that contain transparency.
-Added code to correctly open and save paletted png images with incomplete colour palettes.
-Added theater detection for maps. If there's an ini, it'll read it from that.
-Added support for PC and N64 color palettes.
-Added support for saving N64 IMG format, and specifically paletteless greyscale IMG.
-Added read support for terrain tiles; the're triplets of DA4/ND4/PA4 or DA8/ND8/PA8 files.


CnC64ImageViewer versions:

v1.2.2: (03/02/2017 08:00)
-Fixed a crash in the zooming panel arrow keys scrolling.

v1.2.1: (20/11/2016 16:00)
-Added error checking and feedback on failure to load.
-Optimized palette viewer, and added an indicator for transparency.
-Version number is shown on the title bar.
-Fixed a bug in the viewer that made it shift the image slightly up.

v1.2: (19/11/2016 17:21)
-Identified last unknown value in the header as part of the "number of colors" value.
-Added palette viewer.
-Added icon.

v1.1: (19/11/2016 14:35)
-Tool now shows the full header data and other file info.
-Implemented zoom on the viewer.
-Transparency colour in the viewer can be customized.
-Added classic Open / Save buttons with dialogs.

v1.0: (19/11/2016 01:04)
-Very rudimentary decoder and viewer.
-Double-clicking an image saves it to disk as png in folder of origin.
